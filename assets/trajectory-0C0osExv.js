class i extends ui.view.DefaultTheme.TrajectoryUI{constructor(){super();let t=[0,0];this.panelTrajectory.on(Laya.Event.MOUSE_DOWN,this,e=>t=[e.stageX,e.stageY]),this.panelTrajectory.on(Laya.Event.MOUSE_UP,this,e=>{const s=e.stageX-t[0],a=e.stageY-t[1];Math.sqrt(Math.abs(s)+Math.abs(a))>10||this.onNext()}),this.btnSummary.on(Laya.Event.CLICK,this,this.onSummary),this.panelTrajectory.vScrollBar.elasticDistance=150,this.scbSpeed.on(Laya.Event.CHANGE,this,()=>this.speed=this.scbSpeed.value),this.scbSpeed.on(Laya.Event.MOUSE_UP,this,()=>this.onNext())}#a;#e;static load(){return["images/atlas/images/progress.atlas","images/atlas/images/slider.atlas"]}static#o=Laya.plugin.extractComponents(i.uiView,["boxTrajectoryItem"]);#n(){const t=i.#o("boxTrajectoryItem");t.labContent=t.getChildByName("labContent"),t.labAge=t.getChildByName("hboxAge").getChildByName("labAge");const e=$ui.common.trajectoryItem;return $_.deepMapSet(t,e.box),t.grade=s=>{$_.deepMapSet(t,e.grade[s||0])},t.getChildByName("hboxAge")._childs.forEach(s=>s.color=e.ageColor),t.labContent.color=e.contentColor,t}#s;#t;#i;#r;init({propertyAllocate:t,talents:e,enableExtend:s}){this.#r=s,this.boxParticle.visible=!1,this.boxSpeed.visible=!0,this.btnSummary.visible=!1,this.#t=[],this.#s=!1,this.#i=e,core.start(t),this.updateProperty(),this.onNext()}close(){this.scbSpeed.value=0,this.speed=0,this.#t.forEach(t=>{t.removeSelf(),t.destroy()}),this.#t=null}updateProperty(){const t=core.PropertyTypes,e=core.propertys;this.labCharm.text=e[t.CHR],this.labIntelligence.text=e[t.INT],this.labStrength.text=e[t.STR],this.labMoney.text=e[t.MNY],this.labSpirit.text=e[t.SPR]}onNext(){if(this.#s)return;const{age:t,content:e,isEnd:s}=core.next();this.#s=s,s&&(this.boxSpeed.visible=!1,this.btnSummary.visible=!0,Laya.timer.frameOnce(1,this,()=>{this.panelTrajectory.scrollTo(0,this.panelTrajectory.contentHeight)})),this.panelTrajectory.scrollTo(0,this.panelTrajectory.contentHeight),this.renderTrajectory(t,e),t>=100&&(this.boxParticle.visible=!0),this.updateProperty()}renderTrajectory(t,e){const s=this.#n();s.labAge.text=""+t,s.labContent.text=e.map(({type:a,description:r,grade:h,name:n,postEvent:o})=>{switch(a){case"TLT":return`天赋【${n}】发动：${r}`;case"EVT":return r+(o?`
${o}`:"")}}).join(`
`),s.grade(e[e.length-1].grade),this.vboxTrajectory.addChild(s),this.#t.push(s),s.y=this.vboxTrajectory.height}onSummary(){const t=this.#i;$ui.switchView(UI.pages.SUMMARY,{talents:t,enableExtend:this.#r})}get speed(){return this.#a}set speed(t){this.#a=t,this.prgSpeed.value=t/this.scbSpeed.max,clearInterval(this.#e),this.#e=null,t&&(this.#e=setInterval(()=>this.onNext(),3e3*(1-this.prgSpeed.value)+300))}}export{i as default};
