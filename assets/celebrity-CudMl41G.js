class u extends ui.view.CyberTheme.CelebrityUI{constructor(){super(),this.btnRetry.on(Laya.Event.CLICK,this,()=>this.random()),this.btnNext.on(Laya.Event.CLICK,this,this.next),this.panelCharacter.vScrollBar.elasticDistance=150}#e;static#t=Laya.plugin.extractComponents(u.uiView,["boxCharacter","boxTalent","boxUniqueUnGenerate"]);#a(a,e){const{name:i,property:n,talent:o}=a,t=u.#t("boxCharacter"),s=t.getChildByName("vboxStates"),r=t.getChildByName("boxName");r.getChildByName("label").text=i;const c=$_.clone(n);for(const l in c)Math.abs(c[l]-Math.PI)<1e-7&&(c[l]="Ï€");s.getChildByName("label").text=$_.format($lang.F_PropertyStr,c);for(const l of o){const h=u.#t("boxTalent");h.getChildByName("label").text=$_.format($lang.F_TalentSelection,l),h.y=s.height+s.space;let d=h.getChildByName(`grade${l.grade}`);d&&(d.visible=!0),s.addChild(h)}const C=new Laya.Box;return C.height=s.space,C.y=s.height,s.addChild(C),s.scaleY=0,t.dataSource=a,t.switch=l=>s.scaleY=l?1:0,t.click=(l,h)=>{r.offAll(Laya.Event.CLICK),r.on(Laya.Event.CLICK,h||this,l)},e&&t.click(e),t}#n(a){const e=u.#t("boxUniqueUnGenerate"),i=e.getChildByName("boxName"),n=e.getChildByName("vboxStates"),o=n.getChildByName("label"),s=n.getChildByName("boxBtn").getChildByName("btn");return o.event(Laya.Event.RESIZE),n.scaleY=0,e.dataSource=!1,e.switch=r=>n.scaleY=r?1:0,e.click=(r,c)=>{i.offAll(Laya.Event.CLICK),i.on(Laya.Event.CLICK,c||this,r)},e.generate=(r,c)=>{s.offAll(Laya.Event.CLICK),s.on(Laya.Event.CLICK,c||this,r)},a&&e.generate(a),e}init(){this.random()}close(){this.#e=null,this.vboxCharacter.destroyChildren(!0)}random(a){this.#e=null,this.vboxCharacter.destroyChildren(!0);const{unique:e,normal:i}=core.characterRandom(),n=[],o=this.generateUnique(e,()=>{core.generateUnique(),this.random(i)});o&&n.push(o),(a||i).forEach(t=>n.push(this.#a(t))),n.forEach((t,s)=>{t.y=s,this.vboxCharacter.addChild(t),t.click(()=>{this.#e&&this.#e.switch(!1),this.#e=t,t.switch(!0),t.event(Laya.Event.RESIZE)})}),a&&o&&(this.#e=o,o.switch(!0),o.event(Laya.Event.RESIZE))}generateUnique(a,e){return a?a.generate?(a.name=$lang.UI_UniqueWaTaShi,this.#a(a)):this.#n(e):null}next(){if(!this.#e)return $$event("message",["M_PleaseSelectOne"]);if(!this.#e.dataSource)return $$event("message",["M_UnGenerate"]);const{property:a,talent:e}=this.#e.dataSource,i=core.remake(e.map(n=>n.id));i.length>0&&$$event("message",[i.map(n=>["F_TalentReplace",n])]),$ui.switchView(UI.pages.TRAJECTORY,{propertyAllocate:a,talents:e,enableExtend:!1})}}export{u as default};
