class h extends ui.view.DefaultTheme.PropertyUI{constructor(){super();const t=this.#t=core.PropertyTypes;this.btnCharmIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.CHR,1]),this.btnCharmReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.CHR,-1]),this.btnIntelligenceIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.INT,1]),this.btnIntelligenceReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.INT,-1]),this.btnStrengthIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.STR,1]),this.btnStrengthReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.STR,-1]),this.btnMoneyIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.MNY,1]),this.btnMoneyReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.MNY,-1]),this.inputCharm.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.CHR]),this.inputIntelligence.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.INT]),this.inputStrength.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.STR]),this.inputMoney.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.MNY]);const e=({currentTarget:s})=>{s.text=""};this.inputCharm.on(Laya.Event.MOUSE_DOWN,this,e),this.inputIntelligence.on(Laya.Event.MOUSE_DOWN,this,e),this.inputStrength.on(Laya.Event.MOUSE_DOWN,this,e),this.inputMoney.on(Laya.Event.MOUSE_DOWN,this,e),this.btnRandomAllocate.on(Laya.Event.CLICK,this,this.random),this.btnNext.on(Laya.Event.CLICK,this,this.next),this.listSelectedTalents.renderHandler=Laya.Handler.create(this,this.renderTalent,null,!1)}#t;#i;#e;#s;init({talents:t}){this.listSelectedTalents.array=t;const e=core.remake(t.map(s=>s.id));e.length>0&&$$event("message",[e.map(s=>["F_TalentReplace",s])]),this.#i=core.getPropertyPoints(),this.#s=core.propertyAllocateLimit,this.labLeftPropertyPoint.text=this.#i,this.#e={[this.#t.CHR]:0,[this.#t.INT]:0,[this.#t.STR]:0,[this.#t.MNY]:0},this.updateAllocate()}next(){const t=this.#i-this.total;if(t>0)return $$event("message",["F_PropertyPointLeft",t]);$ui.switchView(UI.pages.TRAJECTORY,{propertyAllocate:this.#e,talents:this.listSelectedTalents.array,enableExtend:!0})}get total(){return this.#e[this.#t.CHR]+this.#e[this.#t.INT]+this.#e[this.#t.STR]+this.#e[this.#t.MNY]}updateAllocate(){const t=this.#e[this.#t.CHR],e=this.#e[this.#t.INT],s=this.#e[this.#t.STR],i=this.#e[this.#t.MNY];this.inputCharm.text=""+t,this.inputIntelligence.text=""+e,this.inputStrength.text=""+s,this.inputMoney.text=""+i,this.labLeftPropertyPoint.text=this.#i-this.total,this.btnCharmIncrease.disabled=this.btnCharmIncrease.gray=!1,this.btnCharmReduce.disabled=this.btnCharmReduce.gray=!1,this.btnIntelligenceIncrease.disabled=this.btnIntelligenceIncrease.gray=!1,this.btnIntelligenceReduce.disabled=this.btnIntelligenceReduce.gray=!1,this.btnStrengthIncrease.disabled=this.btnStrengthIncrease.gray=!1,this.btnStrengthReduce.disabled=this.btnStrengthReduce.gray=!1,this.btnMoneyIncrease.disabled=this.btnMoneyIncrease.gray=!1,this.btnMoneyReduce.disabled=this.btnMoneyReduce.gray=!1}check(t,e,s){return!(s<t||s>e)}random(){let t=this.#i;const e=new Array(4).fill(this.#s[1]);for(;t>0;){const s=Math.round(Math.random()*(Math.min(t,this.#s[1])-1))+1;for(;;){const i=Math.floor(Math.random()*4)%4;if(!(e[i]-s<0)){e[i]-=s,t-=s;break}}}this.#e[this.#t.CHR]=this.#s[1]-e[0],this.#e[this.#t.INT]=this.#s[1]-e[1],this.#e[this.#t.STR]=this.#s[1]-e[2],this.#e[this.#t.MNY]=this.#s[1]-e[3],this.updateAllocate()}onPropertyAllocate(t,e){this.check(this.#s[0],this.#s[1],this.#e[t]+e)&&this.check(0,this.#i,this.total+e)&&(this.#e[t]+=e,this.updateAllocate())}onPropertyAllocateInput(t,e){let s=parseInt(e.text)||0;const i=this.total;i+s<0?s=this.#s[0]*4-i:i+s>this.#i&&(s=this.#i-i),s<this.#s[0]?s=this.#s[0]:s>this.#s[1]&&(s=this.#s[1]);const n=s-this.#e[t];n?this.onPropertyAllocate(t,n):this.updateAllocate()}renderTalent(t){const e=t.dataSource;t.label=$_.format($lang.F_TalentSelection,e);const s=$ui.common.card[e.grade].normal;$_.deepMapSet(t,s)}}export{h as default};
