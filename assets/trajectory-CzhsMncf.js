class h extends ui.view.CyberTheme.CyberTrajectoryUI{constructor(){super();let t=[0,0];this.panelTrajectory.on(Laya.Event.MOUSE_DOWN,this,a=>t=[a.stageX,a.stageY]),this.panelTrajectory.on(Laya.Event.MOUSE_UP,this,a=>{const i=a.stageX-t[0],l=a.stageY-t[1];Math.sqrt(Math.abs(i)+Math.abs(l))>10||this.onNext()}),this.btnSummary.on(Laya.Event.CLICK,this,this.onSummary),this.panelTrajectory.vScrollBar.elasticDistance=150;let e=null,s=null;const r=a=>{let i=this.panelTrajectory.vScrollBar.value+a;i<0&&(i=0),i>this.panelTrajectory.vScrollBar.max&&(i=this.panelTrajectory.vScrollBar.max),this.panelTrajectory.scrollTo(0,i)},n=(a,i)=>{a.off(Laya.Event.CLICK,this,r),a.on(Laya.Event.CLICK,this,r,[100*i]),s=setTimeout(()=>{a.off(Laya.Event.CLICK,this,r),e=setInterval(()=>r(10*i),10)},100)},o=()=>{e&&(clearInterval(e),e=null),s&&(clearTimeout(s),s=null)};this.btnUp.on(Laya.Event.MOUSE_DOWN,this,n,[this.btnUp,-1]),this.btnDown.on(Laya.Event.MOUSE_DOWN,this,n,[this.btnDown,1]),this.btnUp.on(Laya.Event.MOUSE_UP,this,o),this.btnUp.on(Laya.Event.MOUSE_OUT,this,o),this.btnDown.on(Laya.Event.MOUSE_UP,this,o),this.btnDown.on(Laya.Event.MOUSE_OUT,this,o),this.scbSpeed.on(Laya.Event.CHANGE,this,()=>this.speed=this.scbSpeed.value),this.scbSpeed.on(Laya.Event.MOUSE_UP,this,()=>this.onNext())}#a;#e;static#n=Laya.plugin.extractComponents(h.uiView,["boxTrajectoryItem"]);#o(){const t=h.#n("boxTrajectoryItem");return t.labContent=t.getChildByName("labContent"),t.labAge=t.getChildByName("hboxAge").getChildByName("labAge"),t.boxGrade=t.getChildByName("boxGrade"),t}#s;#t;#i;#r;init({propertyAllocate:t,talents:e,enableExtend:s}){this.#r=s,this.boxParticle.visible=!1,this.boxSpeed.visible=!0,this.btnSummary.visible=!1,this.#t=[],this.#s=!1,this.#i=e,core.start(t),this.updateProperty(),this.onNext()}close(){this.scbSpeed.value=0,this.speed=0,this.#t.forEach(t=>{t.removeSelf(),t.destroy()}),this.#t=null}updateProperty(){const t=core.PropertyTypes,e=core.propertys;this.labCharm.text=e[t.CHR],this.labIntelligence.text=e[t.INT],this.labStrength.text=e[t.STR],this.labMoney.text=e[t.MNY],this.labSpirit.text=e[t.SPR]}onNext(){if(this.#s)return;const{age:t,content:e,isEnd:s}=core.next();this.#s=s,s&&(this.boxSpeed.visible=!1,this.btnSummary.visible=!0,Laya.timer.frameOnce(1,this,()=>{this.panelTrajectory.scrollTo(0,this.panelTrajectory.contentHeight)})),this.panelTrajectory.scrollTo(0,this.panelTrajectory.contentHeight),this.renderTrajectory(t,e),t>=100&&(this.boxParticle.visible=!0),this.updateProperty()}renderTrajectory(t,e){const s=this.#o();s.labAge.text=""+t,s.labContent.text=e.map(({type:r,description:n,grade:o,name:a,postEvent:i})=>{switch(r){case"TLT":return`天赋【${a}】发动：${n}`;case"EVT":return n+(i?`
${i}`:"")}}).join(`
`),$_.deepMapSet(s.boxGrade,$ui.common.gradeBlk[e[e.length-1].grade||0]),this.vboxTrajectory.addChild(s),this.#t.push(s),s.y=this.vboxTrajectory.height}onSummary(){const t=this.#i;$ui.switchView(UI.pages.SUMMARY,{talents:t,enableExtend:this.#r})}get speed(){return this.#a}set speed(t){this.#a=t,this.prgSpeed.value=t/this.scbSpeed.max,clearInterval(this.#e),this.#e=null,t&&(this.#e=setInterval(()=>this.onNext(),3e3*(1-this.prgSpeed.value)+300))}}export{h as default};
