class u extends ui.view.DefaultTheme.CelebrityUI{constructor(){super(),this.btnRetry.on(Laya.Event.CLICK,this,()=>this.random()),this.btnNext.on(Laya.Event.CLICK,this,this.next),this.panelCharacter.vScrollBar.elasticDistance=150}#e;static#t=Laya.plugin.extractComponents(u.uiView,["boxCharacter","boxTalent","boxUniqueUnGenerate"]);#a(t,o){const{name:e,property:r,talent:a}=t,n=$ui.common.characterItem,i=u.#t("boxCharacter"),s=i.getChildByName("vboxStates"),c=i.getChildByName("boxName");c.label=e;const h=$_.clone(r);for(const l in h)Math.abs(h[l]-Math.PI)<1e-7&&(h[l]="Ï€");s.label=$_.format($lang.F_PropertyStr,h),$_.deepMapSet(c,n.name),$_.deepMapSet(s,n.state);for(const l of a){const m=u.#t("boxTalent");m.label=$_.format($lang.F_TalentSelection,l),m.y=s.height+s.space,$_.deepMapSet(m,$ui.common.card[l.grade].normal),s.addChild(m)}const d=new Laya.Box;return d.height=s.space,d.y=s.height,s.addChild(d),s.scaleY=0,i.dataSource=t,i.switch=l=>s.scaleY=l?1:0,i.click=(l,m)=>{c.offAll(Laya.Event.CLICK),c.on(Laya.Event.CLICK,m||this,l)},o&&i.click(o),i}#n(t){const o=$ui.common.characterItem,e=u.#t("boxUniqueUnGenerate"),r=e.getChildByName("boxName"),a=e.getChildByName("vboxStates"),n=a.getChildByName("label"),i=a.getChildByName("boxBtn"),s=i.getChildByName("btn");return $_.deepMapSet(r,o.name),$_.deepMapSet(a,o.state),$_.deepMapSet(s,o.name),i.y=n.height+a.space,n.event(Laya.Event.RESIZE),a.scaleY=0,e.dataSource=!1,e.switch=c=>a.scaleY=c?1:0,e.click=(c,h)=>{r.offAll(Laya.Event.CLICK),r.on(Laya.Event.CLICK,h||this,c)},e.generate=(c,h)=>{s.offAll(Laya.Event.CLICK),s.on(Laya.Event.CLICK,h||this,c)},t&&e.generate(t),e}init(){this.random()}close(){this.#e=null,this.vboxCharacter.destroyChildren(!0)}random(t){this.#e=null,this.vboxCharacter.destroyChildren(!0);const{unique:o,normal:e}=core.characterRandom(),r=[],a=this.generateUnique(o,()=>{core.generateUnique(),this.random(e)});a&&r.push(a),(t||e).forEach(n=>r.push(this.#a(n))),r.forEach((n,i)=>{n.y=i,this.vboxCharacter.addChild(n),n.click(()=>{this.#e&&this.#e.switch(!1),this.#e=n,n.switch(!0),n.event(Laya.Event.RESIZE)})}),t&&a&&(this.#e=a,a.switch(!0),a.event(Laya.Event.RESIZE))}generateUnique(t,o){return t?t.generate?(t.name=$lang.UI_UniqueWaTaShi,this.#a(t)):this.#n(o):null}next(){if(!this.#e)return $$event("message",["M_PleaseSelectOne"]);if(!this.#e.dataSource)return $$event("message",["M_UnGenerate"]);const{property:t,talent:o}=this.#e.dataSource,e=core.remake(o.map(r=>r.id));e.length>0&&$$event("message",[e.map(r=>["F_TalentReplace",r])]),$ui.switchView(UI.pages.TRAJECTORY,{propertyAllocate:t,talents:o,enableExtend:!1})}}export{u as default};
